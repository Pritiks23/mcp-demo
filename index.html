<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MCP Demo — Client + Gemini</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--muted:#98a0b3;--accent:#6ee7b7;--glass: rgba(255,255,255,0.03)}
    *{box-sizing:border-box;font-family:Inter,system-ui,Arial,sans-serif}
    body{margin:0;background:linear-gradient(180deg,#061026 0%,#081226 60%);color:#e6eef8;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:28px}
    .app{width:1100px;max-width:100%;display:grid;grid-template-columns:360px 1fr;gap:20px}
    .panel{background:var(--card);padding:18px;border-radius:14px;box-shadow:0 6px 30px rgba(2,6,23,0.6);border:1px solid rgba(255,255,255,0.03)}
    h1{margin:0 0 6px;font-size:18px}
    p.lead{margin:0 0 12px;color:var(--muted);font-size:13px}
    .model-list{display:flex;flex-direction:column;gap:10px}
    .model{padding:10px;border-radius:10px;background:var(--glass);cursor:pointer;border:1px solid rgba(255,255,255,0.02)}
    .model.active{outline:2px solid rgba(110,231,183,0.12);background:linear-gradient(0deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02))}
    .meta{font-size:12px;color:var(--muted);margin-top:8px}
    .controls{display:flex;gap:8px;margin-top:12px}
    button{background:transparent;border:1px solid rgba(255,255,255,0.06);padding:8px 10px;border-radius:8px;color:inherit;cursor:pointer}
    button.primary{background:linear-gradient(90deg,#0ea5a7,#7c3aed);border:none}
    .viewport{display:flex;flex-direction:column;height:640px}
    .chat{flex:1;overflow:auto;padding:16px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00));border-radius:12px}
    .msg{max-width:78%;padding:12px;border-radius:10px;margin-bottom:10px;font-size:14px}
    .msg.user{background:linear-gradient(90deg,#0ea5a7,#7c3aed);color:#001018;margin-left:auto}
    .msg.model{background:rgba(255,255,255,0.03)}
    .input-area{display:flex;gap:10px;margin-top:12px}
    textarea{flex:1;min-height:64px;background:transparent;border:1px solid rgba(255,255,255,0.04);padding:10px;border-radius:10px;color:inherit;resize:vertical}
    .sidebar-section{margin-top:14px}
    .kbd{background:rgba(255,255,255,0.03);padding:6px 8px;border-radius:6px;font-size:12px}
    .small{font-size:12px;color:var(--muted)}
    .row{display:flex;gap:8px;align-items:center}
    .file-input{display:flex;gap:8px}
    .context-list{max-height:140px;overflow:auto;margin-top:8px;border-radius:8px;padding:8px;background:rgba(255,255,255,0.01);border:1px dashed rgba(255,255,255,0.02)}
    .context-item{padding:6px;border-radius:6px;font-size:13px;background:rgba(255,255,255,0.02);margin-bottom:6px}
    .footer{margin-top:8px;font-size:12px;color:var(--muted)}
    .badge{padding:6px 8px;border-radius:999px;background:rgba(255,255,255,0.02);font-size:12px}
    .topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
    .logo{display:flex;gap:10px;align-items:center}
    .logo .dot{width:28px;height:28px;border-radius:8px;background:linear-gradient(90deg,#7c3aed,#0ea5a7);display:flex;align-items:center;justify-content:center;font-weight:700}
    .note{font-size:13px;color:var(--muted)}
    a.smalllink{color:var(--accent);text-decoration:none}
  </style>
</head>
<body>
  <div class="app">
    <div class="panel">
      <div class="topbar"><div class="logo"><div class="dot">M</div><div><strong>MCP Demo</strong><div class="small">Client + Gemini API</div></div></div><div class="badge">Hybrid</div></div>
      <h1>Models</h1>
      <p class="lead">Switch between mock models or use Gemini API. Runs in your browser with optional API key.</p>
      <div class="model-list" id="modelList"></div>

      <div class="sidebar-section">
        <div class="row">
          <div class="kbd">Context</div>
          <div style="flex:1"></div>
          <button id="clearContext">Clear</button>
        </div>
        <div class="file-input" style="margin-top:8px">
          <input id="ctxText" placeholder="Paste a short doc or system prompt" style="flex:1;padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:inherit">
          <button id="addCtx">Add</button>
        </div>
        <div class="context-list" id="contextList"></div>
        <div class="footer">Examples: <span class="small">system persona, dataset summary, policy</span></div>
      </div>

      <div class="sidebar-section">
        <h1>Gemini API Key</h1>
        <p class="small">Enter your Gemini API key to enable live responses.</p>
        <input id="geminiKey" type="password" placeholder="Paste API Key here" style="width:100%;padding:8px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.04);color:inherit">
      </div>
    </div>

    <div class="panel viewport">
      <div>
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <h1 id="title">Interactive MCP Playground</h1>
            <div class="note">Simulates MCP (observe → think → act) and supports Gemini API if key is provided.</div>
          </div>
          <div class="row">
            <div class="small">Temp</div>
            <input id="temp" type="range" min="0" max="1" step="0.05" value="0.3">
            <div class="kbd" id="tempVal">0.30</div>
          </div>
        </div>
      </div>

      <div class="chat" id="chat"></div>

      <div class="input-area">
        <textarea id="prompt" placeholder="Write a user message or command (e.g., 'Summarize context')"></textarea>
        <div style="display:flex;flex-direction:column;gap:8px">
          <button class="primary" id="send">Send</button>
          <button id="simulateChain">Run Reasoning Chain</button>
        </div>
      </div>

      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:10px">
        <div class="small">MCP events shown with timestamps. Mock + Gemini models available.</div>
      </div>

    </div>
  </div>

  <script>
    const models = {
      "echo-v0": {name:'Echo Model',desc:'Echoes input',run: async (p,ctx)=>`Echo: ${p}`},
      "assistant-sim": {name:'Assistant Sim',desc:'Summarizes/extracts',run: async (p,ctx)=>{if(p.toLowerCase().includes('summarize'))return ctx.join(' ').slice(0,100)+'...'; return p;}},
      "cot-sim": {name:'Chain-of-Thought',desc:'Step-by-step reasoning',run: async (p,ctx)=>`Step1: Observe\nStep2: Think\nStep3: Act\nConclusion: ${p}`},
      "gemini-live": {name:'Gemini API',desc:'Live Gemini API',run: async (p,ctx)=>{const key=document.getElementById('geminiKey').value.trim(); if(!key)return '❌ No API key'; try{const res=await fetch('https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key='+key,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({contents:[{role:'user',parts:[{text:p}]}]})}); const data=await res.json(); return data?.candidates?.[0]?.content?.parts?.[0]?.text||JSON.stringify(data);}catch(e){return e.message;}}}
    };

    const state={selected:'assistant-sim',context:[]};
    const modelListEl=document.getElementById('modelList'),chatEl=document.getElementById('chat'),promptEl=document.getElementById('prompt'),ctxText=document.getElementById('ctxText'),contextList=document.getElementById('contextList'),tempEl=document.getElementById('temp'),tempVal=document.getElementById('tempVal');

    function renderModels(){modelListEl.innerHTML='';Object.keys(models).forEach(k=>{const m=models[k],el=document.createElement('div');el.className='model'+(state.selected===k?' active':'');el.innerHTML=`<strong>${m.name}</strong><div class="meta">${m.desc}</div>`;el.onclick=()=>{state.selected=k;renderModels();logSys(`Switched model: ${m.name}`)};modelListEl.appendChild(el)})}
    function renderContext(){contextList.innerHTML='';state.context.forEach((c,i)=>{const d=document.createElement('div');d.className='context-item';d.innerHTML=`<div style="display:flex;justify-content:space-between"><div>${c.slice(0,80)}${c.length>80?'...':''}</div><button onclick="removeCtx(${i})">✕</button></div>`;contextList.appendChild(d)})}
    function removeCtx(i){state.context.splice(i,1);renderContext();logSys('Removed context')}
    window.removeCtx=removeCtx;

    document.getElementById('addCtx').onclick=()=>{const v=ctxText.value.trim();if(!v)return;state.context.unshift(v);ctxText.value='';renderContext();logSys('Added context')};
    document.getElementById('clearContext').onclick=()=>{state.context=[];renderContext();logSys('Cleared context')};

    function appendMsg(t,w='model'){const m=document.createElement('div');m.className='msg '+(w==='user'?'user':'model');m.innerHTML=`<div style="font-size:11px;color:var(--muted)">${w} • ${new Date().toLocaleTimeString()}</div><div style="margin-top:6px;white-space:pre-wrap">${t}</div>`;chatEl.appendChild(m);chatEl.scrollTop=chatEl.scrollHeight}
    function logSys(t){const m=document.createElement('div');m.className='msg model';m.style.opacity=0.6;m.innerHTML=`<div style="font-size:11px;color:var(--muted)">system • ${new Date().toLocaleTimeString()}</div><div style="margin-top:6px">${t}</div>`;chatEl.appendChild(m);chatEl.scrollTop=chatEl.scrollHeight}

    function escapeHtml(s){return s.replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;')}

    document.getElementById('send').onclick=async()=>{const p=promptEl.value.trim();if(!p)return;appendMsg(p,'user');promptEl.value='';const model=models[state.selected];logSys(`Sending to ${model.name}`);const out=await model.run(p,state.context.slice(0,10));appendMsg(out,'model')};
    document.getElementById('simulateChain').onclick=async()=>{const p=promptEl.value.trim()||'Explain step-by-step';appendMsg(p,'user');const model=models['cot-sim'];logSys('Chain-of-Thought sim');const out=await model.run(p,state.context.slice(0,10));appendMsg(out,'model')};

    tempEl.oninput=()=>{tempVal.innerText=parseFloat(tempEl.value).toFixed(2)}

    renderModels();renderContext();
  </script>
</body>
</html>
